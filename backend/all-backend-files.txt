

# ===== FILE: ./app.py =====

# backend/app.py

from flask import Flask
from flask_cors import CORS
from backend.routes.jobs import jobs_bp
from backend.routes.candidates import candidates_bp
from backend.routes.questions import questions_bp

def create_app():
    app = Flask(__name__)

    # Enable CORS
    CORS(app)

    # Register blueprints
    app.register_blueprint(jobs_bp, url_prefix="/jobs")
    app.register_blueprint(candidates_bp, url_prefix="/candidates")
    app.register_blueprint(questions_bp, url_prefix="/questions")

    # Root route
    @app.route('/')
    def index():
        return "<h1>TalentMatch API is running ðŸš€</h1><p>Available endpoints: /jobs, /candidates, /questions</p>"

    return app

if __name__ == "__main__":
    app = create_app()
    app.run(debug=True)


# ===== FILE: ./config.py =====



# ===== FILE: ./models/candidate.py =====



# ===== FILE: ./pinecone_client.py =====

import os
from dotenv import load_dotenv
import pinecone

load_dotenv()  # Reads .env from root

PINECONE_API_KEY = os.getenv("PINECONE_API_KEY")
PINECONE_ENV = os.getenv("PINECONE_ENVIRONMENT")  # "us-east-1"

pinecone.init(api_key=PINECONE_API_KEY, environment=PINECONE_ENV)

index = pinecone.Index("talentmatch")


# ===== FILE: ./requirements.txt =====

flask
flask-cors
python-dotenv
openai
pinecone-client


# ===== FILE: ./routes/candidates.py =====

from flask import Blueprint, request, jsonify
from backend.utils.scoring import score_candidate

candidates_bp = Blueprint("candidates", __name__)

# GET index route for testing
@candidates_bp.route("/", methods=["GET"])
def candidates_index():
    return jsonify({
        "message": "Candidates endpoint is active.",
        "usage": "POST /candidates/upload or POST /candidates/add"
    })

# POST route to upload and score candidates
@candidates_bp.route("/upload", methods=["POST"])
def upload_candidates():
    data = request.json
    candidates = data.get("candidates", [])
    if not candidates:
        return jsonify({"error": "Candidates are required"}), 400

    scored = [score_candidate(c) for c in candidates]
    return jsonify(scored)

# POST route to add a candidate
@candidates_bp.route("/add", methods=["POST"])
def add_candidate():
    data = request.json
    # your logic here
    return jsonify({"status": "candidate added"})


# ===== FILE: ./routes/jobs.py =====

from flask import Blueprint, request, jsonify
from backend.utils.parser import parse_job_description
# backend/routes/jobs.py
from backend.pinecone_client import index


jobs_bp = Blueprint("jobs", __name__)

@jobs_bp.route("/analyze", methods=["POST"])
def analyze_job():
    data = request.json
    job_text = data.get("job_text", "")
    if not job_text:
        return jsonify({"error": "Job description is required"}), 400

    parsed = parse_job_description(job_text)
    return jsonify(parsed)


@jobs_bp.route("/", methods=["GET"])
def jobs_index():
    return jsonify({
        "message": "Jobs endpoint is active.",
        "usage": "POST /jobs/analyze with {'job_text': '...'}"
    })


# ===== FILE: ./routes/questions.py =====

from flask import Blueprint, request, jsonify

questions_bp = Blueprint("questions", __name__)

# GET index route for testing
@questions_bp.route("/", methods=["GET"])
def questions_index():
    return jsonify({
        "message": "Questions endpoint is active.",
        "usage": "POST /questions/generate or POST /questions/submit"
    })

# POST route to generate questions
@questions_bp.route("/generate", methods=["POST"])
def generate_questions():
    data = request.json
    candidates = data.get("candidates", [])
    skills = data.get("skills", ["relevant tech"])

    questions = [
        f"Tell us about a project where you used {skills[0]}."
    ]

    for c in candidates:
        questions.append(f"For {c['name']}: describe a challenge you solved in {c.get('experience','N/A')}.")

    return jsonify(questions)

# POST route to submit a question
@questions_bp.route("/submit", methods=["POST"])
def submit_question():
    data = request.json
    # your logic here
    return jsonify({"status": "question submitted"})


# ===== FILE: ./routes/__init__.py =====



# ===== FILE: ./tests/test_routes.py =====



# ===== FILE: ./tests/test_utils.py =====



# ===== FILE: ./utils/embeddings.py =====



# ===== FILE: ./utils/parser.py =====

def parse_job_description(text: str):
    words = text.strip().split()
    return {
        "title": " ".join(words[:3]) or "Untitled Role",
        "skills": ["Python", "React", "Flask"],  # placeholder skills
        "summary": text[:240] + ("..." if len(text) > 240 else ""),
        "scoreHint": min(100, max(40, len(words) * 2)),
    }


# ===== FILE: ./utils/scoring.py =====

import random

def score_candidate(candidate_name: str):
    # Mock scoring logic
    return {
        "name": candidate_name,
        "score": random.randint(50, 100),
        "experience": f"{random.randint(1, 7)} years"
    }


# ===== FILE: ./utils/__init__.py =====



# ===== FILE: ./__init__.py =====

